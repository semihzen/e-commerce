<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>ChuckMuck Profil </title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <!-- Favicons -->
    <link href="assets/img/favicon.png" rel="icon">
    <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect">
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
    <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
    <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
    <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Template Main CSS File -->
    <!-- <link href="assets/css/style2.css" rel="stylesheet"> -->
    <link href="/style.css" rel="stylesheet">

    <!-- =======================================================
  * Template Name: NiceAdmin
  * Template URL: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/
  * Updated: Apr 20 2024 with Bootstrap v5.3.3
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
    <script>function showAlert(message) {
            if (message) {
                alert(message);
            }
        }
        window.onload = function () {
            const message = "<%= message %>";
            showAlert(message);
        };</script>
    <style>
        .tooltip-container {
            position: relative;
            display: inline-block;
        }

        .tooltip-container .tooltip-text {
            visibility: hidden;
            width: 120px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 5px;
            padding: 5px;
            position: absolute;
            bottom: 125%;
            /* Position the tooltip above the icon */
            left: 50%;
            margin-left: -60px;
            /* Center the tooltip */
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* For delayed appearance */
        .tooltip-container.show-tooltip .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        body {
            margin-top: 20px !important;
            color: #1a202c !important;
            text-align: left !important;
            background-color: #e2e8f0 !important;
        }

        .main-body {
            padding: 15px !important;
        }

        .card {
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, .1), 0 1px 2px 0 rgba(0, 0, 0, .06) !important;
        }

        .card {
            position: relative !important;
            display: flex !important;
            flex-direction: column !important;
            min-width: 0 !important;
            word-wrap: break-word !important;
            background-color: #fff !important;
            background-clip: border-box !important;
            border: 0 solid rgba(0, 0, 0, .125) !important;
            border-radius: .25rem !important;
        }

        .card-body {
            flex: 1 1 auto !important;
            min-height: 1px !important;
            padding: 1rem !important;
        }

        .gutters-sm {
            margin-right: -8px !important;
            margin-left: -8px !important;
        }

        .gutters-sm>.col,
        .gutters-sm>[class*=col-] {
            padding-right: 8px !important;
            padding-left: 8px !important;
        }

        .mb-3,
        .my-3 {
            margin-bottom: 1rem !important !important;
        }

        .bg-gray-300 {
            background-color: #e2e8f0 !important;
        }

        .h-100 {
            height: 100% !important;
        }

        .shadow-none {
            box-shadow: none !important;
        }
    </style>
</head>
<% if (typeof error !=='undefined' ) { %>
    <script>
        alert('<%= error %>');  // Kullanıcı bulunamadı mesajını göster
        window.location.href = '/login-signup';  // Kullanıcıyı belirtilen sayfaya yönlendir
    </script>
    <% } %>

        <body>
            <!-- Topbar Start -->
            <div class="container-fluid">

                <div class="row align-items-center py-3 px-xl-5">
                    <div class="col-lg-3 d-none d-lg-block">
                        <a href="/" class="text-decoration-none">
                            <h1 class="m-0 display-5 font-weight-semi-bold"><span
                                    class="text-primary font-weight-bold border px-3 mr-1">Chuck</span>Muck</h1>
                        </a>
                    </div>
                    <div class="col-lg-6 col-6 text-left">

                    </div>

                    <div class="col-lg-3 col-6 text-right">
                        <% if (user) { %>
                            <div class="w3-dropdown-click">
                                <button onclick="myFunction()" class="w3-button custom-button">
                                </button>
                                <div id="Demo" class="w3-dropdown-content w3-bar-block w3-animate-zoom">
                                    <!-- <a href="#" class="w3-bar-item w3-button">Profilim</a> -->


                                    <div class="tooltip-container" id="tooltipContainer">
                                        <a href="/signout" class="w3-bar-item w3-button">
                                            <i class="fa-solid fa-door-open fa-2xl" style="color: #ff2e2e;"></i>
                                        </a>
                                        <span class="tooltip-text">Çıkış Yap</span>
                                    </div>
                                </div>
                            </div>
                            <% } else { %>
                                <a href="/login-signup" class="nav-item nav-link">Giriş Yap veya Kaydol</a>
                                <% } %>

                    </div>
                </div>

            </div>
            <div class="container">
                <div class="main-body">
                    <!-- Breadcrumb -->
                    <nav aria-label="breadcrumb" class="main-breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/">ChuckMuck (Anasayfa)</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Profilim & Siparişlerim</li>
                        </ol>
                    </nav>
                    <!-- /Breadcrumb -->

                    <div class="row gutters-sm">
                        <div class="col-md-4 mb-3">
                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex flex-column align-items-center text-center">
                                        <div class="profile-circle" style="position: relative;">
                                            <% if (photograph) { %>
                                                <img src="data:image/png;base64,<%= photograph.toString('base64') %>"
                                                    class="rounded-circle" width="150"
                                                    style="object-fit: cover; height: 150px; width: 150px;">
                                                <% } else { %>
                                                    <img src="assets/img/default.png" class="rounded-circle" width="150"
                                                        style="object-fit: cover; height: 150px; width: 150px;">
                                                    <% } %>
                                        </div>
                                        <div class="mt-3" style="margin-top: 12% !important;">
                                            <h4>
                                                <%= name %>
                                                    <%= surname %>
                                            </h4>
                                            <form action="/upload-photo" method="post" enctype="multipart/form-data"
                                                style="display: inline-block;">
                                                <input type="file" name="photo" accept="image/*" style="display: none;"
                                                    id="photoInput">
                                                <label for="photoInput" class="btn "><div class="tooltip-container" id="tooltipContainer"><i
                                                    class="fa-regular fa-file-image fa-xl"
                                                    style="color: #d2746a;"></i>
                                                    <span class="tooltip-text">Fotoğraf Seç </span></div></label> <br>
                                                <button type="submit" class="btn btn-primary">Fotoğrafı Yükle</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>



                        <div class="col-md-8">
                            <div class="card mb-3">
                                <div class="card-body">
                                    <form id="profileForm" action="/update-profile" method="post">
                                        <div class="row mb-3">
                                            <div class="col-sm-3">
                                                <h6 class="mb-0">Ad</h6>
                                            </div>
                                            <div class="col-sm-9 text-secondary1">
                                                <input type="text" name="name" class="form-control" value="<%= name %>"
                                                    disabled>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-sm-3">
                                                <h6 class="mb-0">Soyad</h6>
                                            </div>
                                            <div class="col-sm-9 text-secondary1">
                                                <input type="text" name="surname" class="form-control"
                                                    value="<%= surname %>" disabled>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-sm-3">
                                                <h6 class="mb-0">Telefon Numarası</h6>
                                            </div>
                                            <div class="col-sm-9 text-secondary1">
                                                <input type="text" name="telefonno" class="form-control"
                                                    value="<%= telefonno %>" disabled>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-sm-3">
                                                <h6 class="mb-0">Adres</h6>
                                            </div>
                                            <div class="col-sm-9 text-secondary1">
                                                <input type="text" name="adres" class="form-control"
                                                    value="<%= adres %>" disabled>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-sm-3">
                                                <h6 class="mb-0">E-posta</h6>
                                            </div>
                                            <div class="col-sm-9 text-secondary1">
                                                <input type="email" name="email" class="form-control"
                                                    value="<%= email %>" readonly>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <button type="button" id="editButton" class="btn btn-info">Bilgilerimi
                                                    Düzenle</button>
                                            </div>
                                            <div class="col-sm-6">
                                                <button type="submit" id="submitButton" class="btn btn-primary"
                                                    disabled> Bilgilerimi Güncelle</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>





                    </div>
                </div>

            </div>
           
            <div class="col-md-8" style="margin-left: 17%; ;">
                <div class="card mb-3">
                    <div class="card-body">
                        <h3>Siparişlerim</h3> <hr>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">Ürünün Fotoğrafı</th>
                                    <th scope="col">Ürünün Adı</th>
                                    <th scope="col">Adeti</th>
                                    <th scope="col">Toplam Fiyat</th>
                                    <th scope="col">Satılan Adres</th>
                                    <th scope="col">Ürün Durumu</th>
                                    <th scope="col">Sipariş İptal</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% if (data.length > 0) { %>
                                    <% data.forEach(item => { %>
                                        <tr>
                                            <td>
                                                <% if (item.photograph) { %>
                                                    <img src="<%= item.photograph %>" alt="Ürün Fotoğrafı" style="width: 50px; height: 50px;">
                                                <% } else { %>
                                                    Fotoğraf yok
                                                <% } %>
                                            </td>
                                            <td><%= item.product_name %></td>
                                            <td><%= item.satilan_adet %></td>
                                            <td><%= item.toplam_fiyat %></td>
                                            <td><%= item.adres %></td>
                                            <td><%= item.durum %></td>
                                            <td>   <form action="/cancel-order" method="POST" onsubmit="return confirmCancel()">
                                                <input type="hidden" name="orderId" value="<%= item.id %>">
                                                <button type="submit" style="background:none;border:none;">
                                                    <i class="fa-solid fa-xmark fa-xl" style="color: #ff0000;"></i>
                                                </button>
                                            </form></td>
                                        </tr>
                                    <% }) %>
                                <% } else { %>
                                    <tr>
                                        <td colspan="6">Hiçbir satış bulunamadı.</td>
                                    </tr>
                                <% } %>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            </div>
           
            <!-- ======= Footer ======= -->
            <!-- End Footer -->

            <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
                    class="bi bi-arrow-up-short"></i></a>

            <!-- Vendor JS Files -->
            <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
            <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
            <script src="assets/vendor/chart.js/chart.umd.js"></script>
            <script src="assets/vendor/echarts/echarts.min.js"></script>
            <script src="assets/vendor/quill/quill.js"></script>
            <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
            <script src="assets/vendor/tinymce/tinymce.min.js"></script>
            <script src="assets/vendor/php-email-form/validate.js"></script>

            <!-- Template Main JS File -->
            <script src="assets/js/main2.js"></script>
            <script>
                document.getElementById('editButton').addEventListener('click', function () {
                    const inputs = document.querySelectorAll('#profileForm input');
                    inputs.forEach(input => {
                        if (input.name !== 'email') {  // E-posta alanı hariç diğerlerini aktif yap
                            input.disabled = false;
                        }
                    });
                    document.getElementById('submitButton').disabled = false; // Güncelle butonunu aktif yap
                });
                document.querySelector('form').addEventListener('submit', function (event) {
                    const photoInput = document.getElementById('photoInput');
                    if (!photoInput.files || !photoInput.files.length) {
                        alert('Lütfen bir fotoğraf seçin.');
                        event.preventDefault();  // Formun gönderilmesini durdur
                    }
                });
                const tooltipContainer = document.getElementById('tooltipContainer');

                let tooltipTimeout;

                tooltipContainer.addEventListener('mouseover', () => {
                    tooltipTimeout = setTimeout(() => {
                        tooltipContainer.classList.add('show-tooltip');
                    }, 500); // 500ms delay
                });

                tooltipContainer.addEventListener('mouseout', () => {
                    clearTimeout(tooltipTimeout);
                    tooltipContainer.classList.remove('show-tooltip');
                });
                function confirmCancel() {
        return confirm('Siparişi iptal etmek istiyor musunuz?');
    }
            </script>

        </body>

</html>